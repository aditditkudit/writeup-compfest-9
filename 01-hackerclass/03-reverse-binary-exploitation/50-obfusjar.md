Obfusjar (50)
=============

## Description

We are given a single Obfus.jar file.

## Write Up

JAR is just a zip file, so let's first unzip it.

```bash
❯ unzip Obfus.jar -d unzipped
Archive:  Obfus.jar
  inflating: unzipped/META-INF/MANIFEST.MF
  inflating: unzipped/Obfusjar.class
```

We see a single entry point class, `Obfusjar.class`, let's decompile it with `jad`.

```bash
❯ unzip Obfus.jar -d unzipped
Archive:  Obfus.jar
  inflating: unzipped/META-INF/MANIFEST.MF
  inflating: unzipped/Obfusjar.class
```

Then we can see an `Obfusjar.jad` file in our current working directory.

```java
// Decompiled by Jad v1.5.8e. Copyright 2001 Pavel Kouznetsov.
// Jad home page: http://www.geocities.com/kpdus/jad.html
// Decompiler options: packimports(3)

import java.io.PrintStream;

public class Obfusjar
{

    public Obfusjar()
    {
    }

    public static void main(String args[])
    {
label0:
        {
label1:
            {
                if(args.length != 1)
                {
                    System.out.println("Usage: java -jar Obfus.jar [flag]");
                    System.exit(1);
                }
                if((args = args[0]).length() != ((args.charAt(0) - 65) + 1) * 7)
                {
                    if(true)
                        break label0;
                    break label1;
                }
                int ai[] = {
                    5, -5, -10, 21, -5, 1, -4, -7, 14, 10
                };
                int i = 0;
                do
                {
                    if(i >= 10)
                        break;
                    if(args.charAt(i + 10) + ai[i] != args.charAt(i + 11))
                    {
                        if(true)
                            break label0;
                        break label1;
                    }
                    i++;
                } while(true);
                if(false)
                    break label0;
            }
            System.out.println("Correct!");
            return;
        }
        System.out.println("False :(");
    }
}
```

Then we can see that

```
if((args = args[0]).length() != ((args.charAt(0) - 65) + 1) * 7)
{
    if(true)
        break label0;
    break label1;
}
```

will check if the length of the flag is exactly (flag[0] - 65 + 1) * 7. If we put in the flag format, `COMPFEST9{...}`, we can see that `flag[0]` is `C (67)`,  thus the length of the flag is `21`.

The next portion of the code

```
int ai[] = {
    5, -5, -10, 21, -5, 1, -4, -7, 14, 10
};
int i = 0;
do
{
    if(i >= 10)
        break;
    if(args.charAt(i + 10) + ai[i] != args.charAt(i + 11))
    {
        if(true)
            break label0;
        break label1;
    }
    i++;
} while(true);
```

will check character 10 to 20 if the difference between consecutive character match the array `ai`. Again with the flag format, we can derive the flag, starting from the rightmost (`}`), we subtract 10, then 14, then add 7, and so on, giving us the flag, `COMPFEST9{ini_toples}`.
